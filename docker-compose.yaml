services:

  ollama:
    image: ollama/ollama
    environment:
      - OLLAMA_NO_PRELOAD=1
    ports:
      - 11434:11434
    volumes:
      - ./.ollama:/root/.ollama

  ollama_init:
    image: curlimages/curl
    environment:
      - API_URL=ollama:11434
      - MODEL_NAME=mixtral:8x7b
      - MODEL_NAME=tinyllama
    depends_on:
      - ollama
    restart: no
    entrypoint: [ "sh", "-c", 'curl -X POST "$${API_URL}"/api/pull -d "{\"model\": \"$${MODEL_NAME}\"}"' ] 

  knowledgebase:
    image: semitechnologies/weaviate:latest
    ports:
      - "711:711"
    environment:
      QUERY_DEFAULTS_LIMIT: 25
      AUTHENTICATION_ANONYMOUS_ACCES_ENABLED: "true"
      ENABLE_API_BASED_MODULES: "true"
    network_mode: "host"
    restart: on-failure:0
    command:
      - --port
      - "711"
      - --scheme
      - http
